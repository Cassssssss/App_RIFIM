{"ast":null,"code":"// src/pages/LocationDetail.js\nimport React,{useState,useCallback}from'react';import{useParams,useNavigate}from'react-router-dom';import{Plus,Search,ChevronLeft,Trash2,Edit}from'lucide-react';import{api}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const LocationDetail=()=>{const{locationId,systemId}=useParams();console.log('LocationDetail Params:',{locationId,systemId});const navigate=useNavigate();const[activeTab,setActiveTab]=useState('measure');const[content,setContent]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const loadContent=useCallback(async()=>{if(!locationId){setError('ID de localisation manquant');setLoading(false);return;}try{setLoading(true);const data=await api.getLocationContent(locationId,activeTab);setContent(Array.isArray(data)?data:[]);setError(null);}catch(error){console.error('Erreur:',error);setError('Erreur lors du chargement du contenu');setContent([]);}finally{setLoading(false);}},[locationId,activeTab]);React.useEffect(()=>{loadContent();},[loadContent]);const handleTabChange=async tab=>{setActiveTab(tab);};const handleDelete=async(contentId,e)=>{e.stopPropagation();// Empêche la navigation lors du clic sur supprimer\nif(!contentId){console.error('ID de contenu manquant');return;}if(window.confirm('Voulez-vous vraiment supprimer cette fiche ?')){try{await api.deleteContent(contentId);await loadContent();}catch(error){console.error('Erreur lors de la suppression:',error);setError('Erreur lors de la suppression de la fiche');}}};const handleEdit=(contentId,e)=>{e.stopPropagation();// Empêche la navigation lors du clic sur éditer\nconsole.log('Navigating to edit with params:',{systemId,locationId,activeTab,contentId});if(!contentId||!locationId||!systemId||!activeTab){console.error('Missing required params:',{contentId,locationId,systemId,activeTab});return;}const editUrl=`/system/${systemId}/location/${locationId}/content/${activeTab}/edit/${contentId}`;console.log('Edit URL:',editUrl);navigate(editUrl);};const handleBack=()=>{navigate(`/system/${systemId}`);};const handleViewContent=contentId=>{navigate(`/system/${systemId}/location/${locationId}/content/${activeTab}/${contentId}/view`);};if(!locationId||!systemId){return/*#__PURE__*/_jsx(\"div\",{className:\"p-4 text-red-600\",children:\"Erreur: Param\\xE8tres manquants\"});}if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"p-4\",children:\"Chargement...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#4f5b93] text-white p-4 flex items-center sticky top-0 z-50\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleBack,className:\"mr-4\",children:/*#__PURE__*/_jsx(ChevronLeft,{size:24})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-semibold truncate\",children:\"D\\xE9tails de la localisation\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex border-b overflow-x-auto sticky top-16 bg-white z-40\",children:[/*#__PURE__*/_jsx(\"button\",{className:`flex-none min-w-[50%] py-3 px-4 ${activeTab==='measure'?'border-b-2 border-[#4f5b93] text-[#4f5b93]':'text-gray-500'}`,onClick:()=>handleTabChange('measure'),children:\"Rep\\xE8res & Mesures\"}),/*#__PURE__*/_jsx(\"button\",{className:`flex-none min-w-[50%] py-3 px-4 ${activeTab==='classification'?'border-b-2 border-[#4f5b93] text-[#4f5b93]':'text-gray-500'}`,onClick:()=>handleTabChange('classification'),children:\"Classifications\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 sm:p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative mb-4\",children:[/*#__PURE__*/_jsx(Search,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\",size:20}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),placeholder:\"Rechercher une fiche...\",className:\"w-full p-2 pl-10 rounded-lg border border-gray-300 text-base\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded mb-4 text-sm\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"grid gap-3\",children:content.filter(item=>item.title.toLowerCase().includes(searchTerm.toLowerCase())).map(item=>/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow p-3 sm:p-4 relative hover:shadow-lg transition-shadow\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center gap-2\",children:[/*#__PURE__*/_jsx(\"h3\",{onClick:()=>handleViewContent(item._id),className:\"text-base sm:text-lg font-semibold text-[#4f5b93] cursor-pointer hover:text-[#3f4973] truncate flex-1\",children:item.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1 sm:gap-2 flex-shrink-0\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>handleEdit(item._id,e),className:\"p-2 text-blue-500 hover:text-blue-700\",\"aria-label\":\"Modifier\",children:/*#__PURE__*/_jsx(Edit,{size:18})}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>handleDelete(item._id,e),className:\"p-2 text-red-500 hover:text-red-700\",\"aria-label\":\"Supprimer\",children:/*#__PURE__*/_jsx(Trash2,{size:18})})]})]})},item._id))})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(!locationId)return;navigate(`/system/${systemId}/location/${locationId}/content/${activeTab}`);},className:\"fixed bottom-4 right-4 sm:bottom-6 sm:right-6 bg-[#4f5b93] text-white rounded-full p-3 sm:p-4 shadow-lg hover:bg-[#3f4973] transition-colors z-50\",children:/*#__PURE__*/_jsx(Plus,{size:24})})]});};export default LocationDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}